<!DOCTYPE html>
<html>

<head>
    <title>Data Collection Dashboard</title>
</head>
<style>
    body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
    }

    p {
        vertical-align: middle;
        align-content: center;
        display: table-cell;
    }

    html {
        width: 100%;
        height: 100%;
    }

    .background-image {
        background-image: url("https://raw.githubusercontent.com/CompEng0001/IoT-and-Our-Schools-Environments-for-Education/master/Media/WebGUI/IoT-Temp-Background.jpg?token=AJTMQ4IKUP2QF2I5GXZZ3H25NEQ4K");
        background-color: #ffffff;
        height: 100%;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        position: relative;
    }

    .background-text {
        text-align: center;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
    }

    .gas-display {
        height: 260px;
        width: 450px;
        background-color: #FFFFFF;
        color: #000000;
        display: table;
    }
</style>

<body>

    <div class="background-image">
        <div class="background-text">
            <table border=2 bordercolor="#FFFFFF">
                <tr>
                    <td colspan="4">
                        <h1 align="center" color="#FFFFFF">Data Collection Dashboard</h1>
                        <h3 align="left" color="#FFFFFF">Today's date: <span id="datetime"></span></h3>
                    </td>
                </tr>
                <tr>
                    <!--Temperature-->
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/charts/1?'bgcolor=%23ffffff&color=%23FF0000&dynamic=true&results=20&title=Temperature&type=step&xaxis=Date%2FTime&yaxis=Temp++%C2%B0C"></iframe>
                    </td>
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/widgets/79788&title=Temperature&update=30"></iframe>
                    </td>
                    <!--END Temperature-->

                    <!--Humidity-->
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/charts/3?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=10&title=Humidity&type=step&xaxis=Date%2FTime&yaxis=Humidity+%25"></iframe>
                    </td>
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/widgets/81880&update=30"></iframe>
                    </td>
                    <!--END Humidity-->
                </tr>
                <tr>
                    <!--Dust-->
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #cccccc;"
                            src="https://thingspeak.com/channels/792104/charts/5?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=20&title=Dust+Concentration&type=line&yaxis=Dust+%28pcs%2F0.01cf%29"></iframe>
                    </td>
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/widgets/96846"></iframe>
                    </td>
                    <!--END Dust-->

                    <!--Pressure-->
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/charts/2?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=10&title=Barometer&type=step&xaxis=Date%2FTime&yaxis=Pressure+%28hPA%29"></iframe>
                    </td>
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/widgets/80175"></iframe>
                    </td>
                    <!--END Pressure-->
                </tr>
                <tr>
                    <!--Gas-->
                    <td>
                        <iframe width="450" height="260" style="border: 1px solid #ffffff;"
                            src="https://thingspeak.com/channels/792104/charts/7?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=20&title=Gas+Levels&type=line&yaxis=Rs%2FRo&yaxismax=10&yaxismin=0"></iframe>
                    </td>
                    <td>
                        <div class="gas-display">
                            <p id="gasParagraph"></p>
                        </div>
                    </td>
                    <!--END Gas-->
                </tr>
            </table>
        </div>
    </div>
</body>

</html>

<script>

    var dt = new Date();
    document.getElementById("datetime").innerHTML = (("0" + dt.getDate()).slice(-2)) + "." + (("0" + (dt.getMonth() + 1)).slice(-2)) + "." + (dt.getFullYear()) + " Current time: " + (("0" + dt.getHours()).slice(-2)) + ":" + (("0" + dt.getMinutes()).slice(-2));

    getGasDetails();

    function getGasDetails() {

        var json_obj = JSON.parse(Get('https://api.thingspeak.com/channels/792104/fields/7/last.json'));
        // only change jso_obj.yourfieldnumber))
        var gas_value = parseFloat(JSON.parse(json_obj.field7)).toFixed(2);
        var GasLookupTable =
        {
            TwoHunPPM: ["0.70", "0.90", "1.70", "3.50", "3.90"],
            FiveHunPPM: ["0.48", "0.69", "1.30", "3.30", "3.40"],
            EightHunPPM: ["0.39", "0.55", "1.10", "3.00", "3.30"],
            OneThouPPM: ["0.37", "0.51", "0.90", "2.70", "2.90"],
            OneSixThouPPM: ["0.30", "0.44", "0.88", "2.30", "2.80"],
            TwoThouPPM: ["0.27", "0.40", "0.81", "2.10", "2.60"],
            ThreeThouPPM: ["0.24", "0.34", "0.78", "2.00", "2.50"],
            FiveThouPPM: ["0.19", "0.28", "0.72", "1.80", "2.40"],
            TenThouPPM: ["0.16", "0.20", "0.68", "1.60", "2.35", "6.50"],
            GasNames: ["LPG", "CH4", "H2", "Alcohol", "C0", "Normal Air"],
            PPM: [200, 500, 800, 1000, 1600, 2000, 3000, 5000, 10000]
        };

        var counter = 0;
        for (var value in GasLookupTable) {
            if (GasLookupTable.hasOwnProperty(value) && GasLookupTable[value].indexOf(gas_value) != -1) {
                let gasIndex = GasLookupTable[value].indexOf(gas_value);
                let gasDetails = GasLookupTable.GasNames[gasIndex] + " " + GasLookupTable.PPM[counter] + " PPM";
                document.getElementById('gasParagraph').innerHTML = "Gas Value is: " + gas_value + " Gas type: " + gasDetails;
                break  //returns gasName and PPM
            }
            counter += 1;
        }
        return "Not found";
    }

    function Get(yourUrl) {
        var Httpreq = new XMLHttpRequest(); // a new request
        Httpreq.open("GET", yourUrl, false);
        Httpreq.send(null);
        return Httpreq.responseText;
    }

    function refreshDate() {
        var dt = new Date();
        document.getElementById("datetime").innerHTML = (("0" + dt.getDate()).slice(-2)) + "." + (("0" + (dt.getMonth() + 1)).slice(-2)) + "." + (dt.getFullYear()) + " Current time: " + (("0" + dt.getHours()).slice(-2)) + ":" + (("0" + dt.getMinutes()).slice(-2));
       // var x = document.getElementById("myiframe");
        //x.src = x.src + Math.floor(random() % 100000);
    }

    function reloadWindow() {
        window.location.reload();
    }
    
    setInterval(refreshDate, 30 * 1000);
</script>